<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Module 6: Introduction to Causal Intference | Help! What Statistical Model Should I Use? 2024</title>
  <meta name="description" content="Workshop website for the 2024 Help! What Statistical Model Should I Use? Canadian Bioinformatics Workshop" />
  <meta name="generator" content="bookdown 0.43 and GitBook 2.6.7" />

  <meta property="og:title" content="Module 6: Introduction to Causal Intference | Help! What Statistical Model Should I Use? 2024" />
  <meta property="og:type" content="book" />
  <meta property="og:image" content="https://bioinformaticsdotca.github.io/STAT_2024/img/bioinformatics_logo.png" />
  <meta property="og:description" content="Workshop website for the 2024 Help! What Statistical Model Should I Use? Canadian Bioinformatics Workshop" />
  <meta name="github-repo" content="bioinformaticsdotca/STAT_2024" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Module 6: Introduction to Causal Intference | Help! What Statistical Model Should I Use? 2024" />
  
  <meta name="twitter:description" content="Workshop website for the 2024 Help! What Statistical Model Should I Use? Canadian Bioinformatics Workshop" />
  <meta name="twitter:image" content="https://bioinformaticsdotca.github.io/STAT_2024/img/bioinformatics_logo.png" />

<meta name="author" content="Faculty: Patrick McMillan, Alysha Cooper, and Jacqueline May" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  <link rel="shortcut icon" href="img/favicon.ico" type="image/x-icon" />
<link rel="prev" href="module-5-putting-it-all-together.html"/>

<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "LearningResource",
  "name": "Help! What Statistical Model Should I Use?",
  "description": "The complete set of tutorials, slides, and practical exercises for the Help! What Statistical Model Should I Use? 2024 Canadian Bioinformatics Workshop, hosted on GitHub Pages.",
  "url": "https://bioinformaticsdotca.github.io/STAT_2024",
  "learningResourceType": ["tutorial", "slides", "exercise"],
  "inLanguage": "en",
  "license": "https://creativecommons.org/licenses/by/4.0/",
  "provider": {
    "@type": "Organization",
    "name": "Bioinformatics.ca",
    "url": "https://bioinformatics.ca"
  },
  "keywords": "",
  "isPartOf": {
    "@type": "Course",
    "@id": "https://bioinformaticsdotca.github.io/STAT_2024/"
  }
}
</script>
</head>


<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<a href="https://bioinformaticsdotca.github.io/">
 <img src="img/bioinformatics_logo.png" width="90%" alt="bioinformatics.ca logo" style="display:block; margin-left:auto; margin-right:auto; margin-top:15px;">
 </a>
<li><center><strong><a href="./"><br>Help! What Statistical Model Should I Use?<br><br></a></strong></center></li>
<a href="./">
 <img src="img/STAT_2024_icon.png" width="70%" alt="Help! What Statistical Model Should I Use? logo" style="display:block; margin-left:auto; margin-right:auto; ">
 </a>
<br>

<li class="divider"></li>
<li class="part"><span><b>I Introduction</b></span></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Workshop Info</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#schedule"><i class="fa fa-check"></i>Schedule</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#pre-work"><i class="fa fa-check"></i>Pre-work</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="data-setup.html"><a href="data-setup.html"><i class="fa fa-check"></i>Data Setup</a></li>
<li class="part"><span><b>II Modules</b></span></li>
<li class="chapter" data-level="" data-path="module-1-data-cleaning-and-exploration-review.html"><a href="module-1-data-cleaning-and-exploration-review.html"><i class="fa fa-check"></i>Module 1: Data Cleaning and Exploration Review</a>
<ul>
<li class="chapter" data-level="" data-path="module-1-data-cleaning-and-exploration-review.html"><a href="module-1-data-cleaning-and-exploration-review.html#lecture"><i class="fa fa-check"></i>Lecture</a></li>
<li class="chapter" data-level="" data-path="module-1-data-cleaning-and-exploration-review.html"><a href="module-1-data-cleaning-and-exploration-review.html#lab"><i class="fa fa-check"></i>Lab</a>
<ul>
<li class="chapter" data-level="" data-path="module-1-data-cleaning-and-exploration-review.html"><a href="module-1-data-cleaning-and-exploration-review.html#load-libraries"><i class="fa fa-check"></i>Load Libraries</a></li>
<li class="chapter" data-level="" data-path="module-1-data-cleaning-and-exploration-review.html"><a href="module-1-data-cleaning-and-exploration-review.html#read-in-data"><i class="fa fa-check"></i>Read in Data</a></li>
<li class="chapter" data-level="" data-path="module-1-data-cleaning-and-exploration-review.html"><a href="module-1-data-cleaning-and-exploration-review.html#looking-at-your-data"><i class="fa fa-check"></i>Looking at your Data</a></li>
<li class="chapter" data-level="" data-path="module-1-data-cleaning-and-exploration-review.html"><a href="module-1-data-cleaning-and-exploration-review.html#working-with-different-data-types"><i class="fa fa-check"></i>Working with Different Data Types</a></li>
<li class="chapter" data-level="" data-path="module-1-data-cleaning-and-exploration-review.html"><a href="module-1-data-cleaning-and-exploration-review.html#summary-stats"><i class="fa fa-check"></i>Summary Stats</a></li>
<li class="chapter" data-level="" data-path="module-1-data-cleaning-and-exploration-review.html"><a href="module-1-data-cleaning-and-exploration-review.html#exploratory-plots"><i class="fa fa-check"></i>Exploratory Plots</a></li>
<li class="chapter" data-level="" data-path="module-1-data-cleaning-and-exploration-review.html"><a href="module-1-data-cleaning-and-exploration-review.html#outlier-detection"><i class="fa fa-check"></i>Outlier Detection</a></li>
<li class="chapter" data-level="" data-path="module-1-data-cleaning-and-exploration-review.html"><a href="module-1-data-cleaning-and-exploration-review.html#dimensionality-reduction"><i class="fa fa-check"></i>Dimensionality Reduction</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="module-2-dealing-with-missingness.html"><a href="module-2-dealing-with-missingness.html"><i class="fa fa-check"></i>Module 2: Dealing with Missingness</a>
<ul>
<li class="chapter" data-level="" data-path="module-2-dealing-with-missingness.html"><a href="module-2-dealing-with-missingness.html#lecture-1"><i class="fa fa-check"></i>Lecture</a></li>
<li class="chapter" data-level="" data-path="module-2-dealing-with-missingness.html"><a href="module-2-dealing-with-missingness.html#lab-1"><i class="fa fa-check"></i>Lab</a>
<ul>
<li class="chapter" data-level="" data-path="module-2-dealing-with-missingness.html"><a href="module-2-dealing-with-missingness.html#load-libraries-1"><i class="fa fa-check"></i>Load Libraries</a></li>
<li class="chapter" data-level="" data-path="module-2-dealing-with-missingness.html"><a href="module-2-dealing-with-missingness.html#read-in-data-1"><i class="fa fa-check"></i>Read in Data</a></li>
<li class="chapter" data-level="" data-path="module-2-dealing-with-missingness.html"><a href="module-2-dealing-with-missingness.html#missing-data-exploration"><i class="fa fa-check"></i>Missing Data Exploration</a></li>
<li class="chapter" data-level="" data-path="module-2-dealing-with-missingness.html"><a href="module-2-dealing-with-missingness.html#imputation-prep"><i class="fa fa-check"></i>Imputation Prep</a></li>
<li class="chapter" data-level="" data-path="module-2-dealing-with-missingness.html"><a href="module-2-dealing-with-missingness.html#missingness-simulation"><i class="fa fa-check"></i>Missingness Simulation</a></li>
<li class="chapter" data-level="" data-path="module-2-dealing-with-missingness.html"><a href="module-2-dealing-with-missingness.html#meanmode-imputation"><i class="fa fa-check"></i>Mean/mode Imputation</a></li>
<li class="chapter" data-level="" data-path="module-2-dealing-with-missingness.html"><a href="module-2-dealing-with-missingness.html#k-nearest-neighbour-imputation"><i class="fa fa-check"></i>K-Nearest Neighbour Imputation</a></li>
<li class="chapter" data-level="" data-path="module-2-dealing-with-missingness.html"><a href="module-2-dealing-with-missingness.html#random-forest-imputation"><i class="fa fa-check"></i>Random Forest Imputation</a></li>
<li class="chapter" data-level="" data-path="module-2-dealing-with-missingness.html"><a href="module-2-dealing-with-missingness.html#mice"><i class="fa fa-check"></i>MICE</a></li>
<li class="chapter" data-level="" data-path="module-2-dealing-with-missingness.html"><a href="module-2-dealing-with-missingness.html#error-rates"><i class="fa fa-check"></i>Error Rates</a></li>
<li class="chapter" data-level="" data-path="module-2-dealing-with-missingness.html"><a href="module-2-dealing-with-missingness.html#impute-the-full-dataset"><i class="fa fa-check"></i>Impute the Full Dataset</a></li>
<li class="chapter" data-level="" data-path="module-2-dealing-with-missingness.html"><a href="module-2-dealing-with-missingness.html#compare-inferences-obtained-from-complete-case-and-imputed-datasets"><i class="fa fa-check"></i>Compare Inferences Obtained from Complete-case and Imputed Datasets</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="module-3-modeling-part-1.html"><a href="module-3-modeling-part-1.html"><i class="fa fa-check"></i>Module 3: Modeling Part 1</a>
<ul>
<li class="chapter" data-level="" data-path="module-3-modeling-part-1.html"><a href="module-3-modeling-part-1.html#lecture-2"><i class="fa fa-check"></i>Lecture</a>
<ul>
<li class="chapter" data-level="" data-path="module-3-modeling-part-1.html"><a href="module-3-modeling-part-1.html#regression"><i class="fa fa-check"></i>Regression</a></li>
<li class="chapter" data-level="" data-path="module-3-modeling-part-1.html"><a href="module-3-modeling-part-1.html#generalized-linear-models"><i class="fa fa-check"></i>Generalized Linear Models</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="module-3-modeling-part-1.html"><a href="module-3-modeling-part-1.html#lab-2"><i class="fa fa-check"></i>Lab</a>
<ul>
<li class="chapter" data-level="" data-path="module-3-modeling-part-1.html"><a href="module-3-modeling-part-1.html#load-libraries-2"><i class="fa fa-check"></i>Load Libraries</a></li>
<li class="chapter" data-level="" data-path="module-3-modeling-part-1.html"><a href="module-3-modeling-part-1.html#multiple-linear-regression-and-the-dietswap-data"><i class="fa fa-check"></i>Multiple Linear Regression and the Dietswap Data</a></li>
<li class="chapter" data-level="" data-path="module-3-modeling-part-1.html"><a href="module-3-modeling-part-1.html#logistic-regression"><i class="fa fa-check"></i>Logistic Regression</a></li>
<li class="chapter" data-level="" data-path="module-3-modeling-part-1.html"><a href="module-3-modeling-part-1.html#binomial-regression"><i class="fa fa-check"></i>Binomial Regression</a></li>
<li class="chapter" data-level="" data-path="module-3-modeling-part-1.html"><a href="module-3-modeling-part-1.html#poisson-regression"><i class="fa fa-check"></i>Poisson Regression</a></li>
<li class="chapter" data-level="" data-path="module-3-modeling-part-1.html"><a href="module-3-modeling-part-1.html#negative-binomial"><i class="fa fa-check"></i>Negative Binomial</a></li>
<li class="chapter" data-level="" data-path="module-3-modeling-part-1.html"><a href="module-3-modeling-part-1.html#independent-work"><i class="fa fa-check"></i>Independent Work</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="module-4-modeling-part-2.html"><a href="module-4-modeling-part-2.html"><i class="fa fa-check"></i>Module 4: Modeling Part 2</a>
<ul>
<li class="chapter" data-level="" data-path="module-4-modeling-part-2.html"><a href="module-4-modeling-part-2.html#lecture-3"><i class="fa fa-check"></i>Lecture</a>
<ul>
<li class="chapter" data-level="" data-path="module-4-modeling-part-2.html"><a href="module-4-modeling-part-2.html#classification"><i class="fa fa-check"></i>Classification</a></li>
<li class="chapter" data-level="" data-path="module-4-modeling-part-2.html"><a href="module-4-modeling-part-2.html#clustering"><i class="fa fa-check"></i>Clustering</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="module-4-modeling-part-2.html"><a href="module-4-modeling-part-2.html#lab-3"><i class="fa fa-check"></i>Lab</a>
<ul>
<li class="chapter" data-level="" data-path="module-4-modeling-part-2.html"><a href="module-4-modeling-part-2.html#classification-1"><i class="fa fa-check"></i>Classification</a></li>
<li class="chapter" data-level="" data-path="module-4-modeling-part-2.html"><a href="module-4-modeling-part-2.html#clustering-1"><i class="fa fa-check"></i>Clustering</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="module-5-putting-it-all-together.html"><a href="module-5-putting-it-all-together.html"><i class="fa fa-check"></i>Module 5: Putting it all Together</a>
<ul>
<li class="chapter" data-level="" data-path="module-5-putting-it-all-together.html"><a href="module-5-putting-it-all-together.html#lecture-4"><i class="fa fa-check"></i>Lecture</a></li>
<li class="chapter" data-level="" data-path="module-5-putting-it-all-together.html"><a href="module-5-putting-it-all-together.html#lab-4"><i class="fa fa-check"></i>Lab</a>
<ul>
<li class="chapter" data-level="" data-path="module-5-putting-it-all-together.html"><a href="module-5-putting-it-all-together.html#breast-cancer"><i class="fa fa-check"></i>Breast Cancer</a></li>
<li class="chapter" data-level="" data-path="module-5-putting-it-all-together.html"><a href="module-5-putting-it-all-together.html#gene-expression"><i class="fa fa-check"></i>Gene Expression</a></li>
<li class="chapter" data-level="" data-path="module-5-putting-it-all-together.html"><a href="module-5-putting-it-all-together.html#genomic-prediction"><i class="fa fa-check"></i>Genomic Prediction</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="module-6-introduction-to-causal-intference.html"><a href="module-6-introduction-to-causal-intference.html"><i class="fa fa-check"></i>Module 6: Introduction to Causal Intference</a>
<ul>
<li class="chapter" data-level="" data-path="module-6-introduction-to-causal-intference.html"><a href="module-6-introduction-to-causal-intference.html#lecture-5"><i class="fa fa-check"></i>Lecture</a></li>
<li class="chapter" data-level="" data-path="module-6-introduction-to-causal-intference.html"><a href="module-6-introduction-to-causal-intference.html#lab-5"><i class="fa fa-check"></i>Lab</a>
<ul>
<li class="chapter" data-level="" data-path="module-6-introduction-to-causal-intference.html"><a href="module-6-introduction-to-causal-intference.html#causal-interfence-introduction"><i class="fa fa-check"></i>Causal Interfence Introduction</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<h1 id="sponsors">Sponsors</h1>
<center>
<a href="https://genomecanada.ca/"><img src="img/sponsors/genomecanada.png" height="70" style="display:inline-block;"  style="padding-bottom: 20px" alt="Genome Canada logo.">
<a href="https://www.ontariogenomics.ca/"><img src="img/sponsors/ontariogenomics.png" height="70" style="display:inline-block;" style="padding-bottom: 20px;" alt="Ontario Genomics logo.">
<br><br>
<a href="https://oicr.on.ca/"><img src="img/sponsors/oicr.png" width=25% style="display:inline-block;" style="padding-bottom: 20px" alt="Ontario Institute for Cancer Research logo.">
<a href="https://www.hpcforhealth.ca/"><img src="img/sponsors/hpc4health.png" width=60% style="display:inline-block;" style="padding-bottom: 20px "alt="HPC4Health logo.">
<br><br>
<a href="https://computationalgenomics.ca/"><img src="img/sponsors/c3g.png" style="display:inline-block;" width=35% style="padding-bottom: 20px" alt="Canadian Centre for Computational Genomcis logo.">

<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li></center>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Help! What Statistical Model Should I Use? 2024</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="module-6-introduction-to-causal-intference" class="section level1 hasAnchor">
<h1>Module 6: Introduction to Causal Intference<a href="module-6-introduction-to-causal-intference.html#module-6-introduction-to-causal-intference" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="lecture-5" class="section level2 hasAnchor">
<h2>Lecture<a href="module-6-introduction-to-causal-intference.html#lecture-5" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<iframe width="640" height="360" src="https://www.youtube.com/embed/b95iYue64DY?si=tCS_WQlz0fxeGqbV" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen>
</iframe>
<p><br></p>
<iframe src="https://drive.google.com/file/d/1WmM0aBJqToy2aoi3gWesHjFlUcV-i_Lg/preview" width="640" height="480" allow="autoplay">
</iframe>
</div>
<div id="lab-5" class="section level2 hasAnchor">
<h2>Lab<a href="module-6-introduction-to-causal-intference.html#lab-5" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="causal-interfence-introduction" class="section level3 hasAnchor">
<h3>Causal Interfence Introduction<a href="module-6-introduction-to-causal-intference.html#causal-interfence-introduction" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="estimating-propensity-scores" class="section level4 hasAnchor">
<h4>Estimating Propensity Scores<a href="module-6-introduction-to-causal-intference.html#estimating-propensity-scores" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>First, we will look at how we can estimate propensity scores using the models we learned in previous modules including logistic regression and random forest.</p>
</div>
<div id="load-libraries-6" class="section level4 hasAnchor">
<h4>Load Libraries<a href="module-6-introduction-to-causal-intference.html#load-libraries-6" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb455"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb455-1"><a href="module-6-introduction-to-causal-intference.html#cb455-1" tabindex="-1"></a><span class="fu">library</span>(tidyverse) <span class="co"># General functions and plots</span></span>
<span id="cb455-2"><a href="module-6-introduction-to-causal-intference.html#cb455-2" tabindex="-1"></a><span class="fu">library</span>(MatchIt)   <span class="co"># For propensity score estimation and matching</span></span>
<span id="cb455-3"><a href="module-6-introduction-to-causal-intference.html#cb455-3" tabindex="-1"></a><span class="fu">library</span>(cobalt)    <span class="co"># For balanced covariate check</span></span>
<span id="cb455-4"><a href="module-6-introduction-to-causal-intference.html#cb455-4" tabindex="-1"></a><span class="fu">library</span>(car)       <span class="co"># For diagnostics</span></span>
<span id="cb455-5"><a href="module-6-introduction-to-causal-intference.html#cb455-5" tabindex="-1"></a><span class="fu">library</span>(randomForest) <span class="co"># for random forest</span></span></code></pre></div>
</div>
<div id="read-in-data-7" class="section level4 hasAnchor">
<h4>Read in Data<a href="module-6-introduction-to-causal-intference.html#read-in-data-7" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>This dataset was taken from the “What If?” textbook by Robins &amp; Hernan (2024). The codebook can be found at this <a href="https://view.officeapps.live.com/op/view.aspx?src=https%3A%2F%2Fcdn1.sph.harvard.edu%2Fwp-content%2Fuploads%2Fsites%2F1268%2F2012%2F10%2FNHEFS_Codebook.xls&amp;wdOrigin=BROWSELINK">link</a>.</p>
<p>Suppose we are interested in determining whether quitting smoking has a causal effect on weight gain. We are given this experimental data with important confounding variables such as smoking intensity, alcohol use, age, sex, race, education, and weight in 1971 that may impact individual’s probabilities of quitting smoking. Let’s account for these via propensity score analysis.</p>
<div class="sourceCode" id="cb456"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb456-1"><a href="module-6-introduction-to-causal-intference.html#cb456-1" tabindex="-1"></a><span class="co"># read in the data</span></span>
<span id="cb456-2"><a href="module-6-introduction-to-causal-intference.html#cb456-2" tabindex="-1"></a>nhefs <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&#39;./datasets/nhefs.csv&#39;</span>) <span class="co"># Use your file path for this data</span></span></code></pre></div>
<div class="sourceCode" id="cb457"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb457-1"><a href="module-6-introduction-to-causal-intference.html#cb457-1" tabindex="-1"></a><span class="co"># look at dataset summary</span></span>
<span id="cb457-2"><a href="module-6-introduction-to-causal-intference.html#cb457-2" tabindex="-1"></a><span class="fu">summary</span>(nhefs)</span>
<span id="cb457-3"><a href="module-6-introduction-to-causal-intference.html#cb457-3" tabindex="-1"></a></span>
<span id="cb457-4"><a href="module-6-introduction-to-causal-intference.html#cb457-4" tabindex="-1"></a><span class="co"># look at structure of data</span></span>
<span id="cb457-5"><a href="module-6-introduction-to-causal-intference.html#cb457-5" tabindex="-1"></a><span class="fu">str</span>(nhefs)</span></code></pre></div>
<div class="sourceCode" id="cb458"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb458-1"><a href="module-6-introduction-to-causal-intference.html#cb458-1" tabindex="-1"></a><span class="co"># we want education, exercise, and active to be factors</span></span>
<span id="cb458-2"><a href="module-6-introduction-to-causal-intference.html#cb458-2" tabindex="-1"></a>nhefs<span class="sc">$</span>education <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(nhefs<span class="sc">$</span>education)</span>
<span id="cb458-3"><a href="module-6-introduction-to-causal-intference.html#cb458-3" tabindex="-1"></a>nhefs<span class="sc">$</span>exercise <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(nhefs<span class="sc">$</span>exercise)</span>
<span id="cb458-4"><a href="module-6-introduction-to-causal-intference.html#cb458-4" tabindex="-1"></a>nhefs<span class="sc">$</span>active <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(nhefs<span class="sc">$</span>active)</span></code></pre></div>
<p>Now let’s look at missingness:</p>
<div class="sourceCode" id="cb459"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb459-1"><a href="module-6-introduction-to-causal-intference.html#cb459-1" tabindex="-1"></a><span class="co"># find % missingness</span></span>
<span id="cb459-2"><a href="module-6-introduction-to-causal-intference.html#cb459-2" tabindex="-1"></a><span class="fu">apply</span>(nhefs,<span class="dv">2</span>,<span class="cf">function</span>(x) <span class="fu">sum</span>(<span class="fu">is.na</span>(x)))<span class="sc">/</span><span class="fu">dim</span>(nhefs)[<span class="dv">1</span>]</span></code></pre></div>
<pre><code>##              seqn              qsmk             death             yrdth 
##       0.000000000       0.000000000       0.000000000       0.804788214 
##             modth             dadth               sbp               dbp 
##       0.802332719       0.802332719       0.047268263       0.049723757 
##               sex               age              race            income 
##       0.000000000       0.000000000       0.000000000       0.038060160 
##           marital            school         education                ht 
##       0.000000000       0.000000000       0.000000000       0.000000000 
##              wt71              wt82           wt82_71        birthplace 
##       0.000000000       0.038674033       0.038674033       0.056476366 
##    smokeintensity smkintensity82_71          smokeyrs            asthma 
##       0.000000000       0.000000000       0.000000000       0.000000000 
##            bronch                tb                hf               hbp 
##       0.000000000       0.000000000       0.000000000       0.000000000 
##       pepticulcer           colitis         hepatitis      chroniccough 
##       0.000000000       0.000000000       0.000000000       0.000000000 
##          hayfever          diabetes             polio             tumor 
##       0.000000000       0.000000000       0.000000000       0.000000000 
##      nervousbreak         alcoholpy       alcoholfreq       alcoholtype 
##       0.000000000       0.000000000       0.000000000       0.000000000 
##    alcoholhowmuch              pica          headache         otherpain 
##       0.255985267       0.000000000       0.000000000       0.000000000 
##         weakheart         allergies            nerves           lackpep 
##       0.000000000       0.000000000       0.000000000       0.000000000 
##            hbpmed      boweltrouble            wtloss         infection 
##       0.000000000       0.000000000       0.000000000       0.000000000 
##            active          exercise      birthcontrol       pregnancies 
##       0.000000000       0.000000000       0.000000000       0.554327808 
##       cholesterol         hightax82           price71           price82 
##       0.009821977       0.056476366       0.056476366       0.056476366 
##             tax71             tax82        price71_82          tax71_82 
##       0.056476366       0.056476366       0.056476366       0.056476366</code></pre>
<p>We might notice high levels of missingness in some columns. For those with moderate missingness, we can consider imputation while those with higher levels should be removed. However, it is important to look at the codebook to see if we can figure out why some of these have such high missingness. For instance, we will notice that alcoholhowmuch is missing for individuals who don’t use alcohol. We can impute this with 0 for these individuals.</p>
<div class="sourceCode" id="cb461"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb461-1"><a href="module-6-introduction-to-causal-intference.html#cb461-1" tabindex="-1"></a><span class="co"># look at alcoholhowmuch across alcohol frequency</span></span>
<span id="cb461-2"><a href="module-6-introduction-to-causal-intference.html#cb461-2" tabindex="-1"></a>nhefs <span class="sc">%&gt;%</span> </span>
<span id="cb461-3"><a href="module-6-introduction-to-causal-intference.html#cb461-3" tabindex="-1"></a>  <span class="fu">group_by</span>(alcoholfreq) <span class="sc">%&gt;%</span></span>
<span id="cb461-4"><a href="module-6-introduction-to-causal-intference.html#cb461-4" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="fu">mean</span>(alcoholhowmuch, <span class="at">na.rm=</span>T))</span></code></pre></div>
<pre><code>## # A tibble: 6 × 2
##   alcoholfreq `mean(alcoholhowmuch, na.rm = T)`
##         &lt;int&gt;                             &lt;dbl&gt;
## 1           0                              3.18
## 2           1                              3.66
## 3           2                              3.38
## 4           3                              2.6 
## 5           4                            NaN   
## 6           5                            NaN</code></pre>
<div class="sourceCode" id="cb463"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb463-1"><a href="module-6-introduction-to-causal-intference.html#cb463-1" tabindex="-1"></a><span class="co"># impute alcoholhowmuch</span></span>
<span id="cb463-2"><a href="module-6-introduction-to-causal-intference.html#cb463-2" tabindex="-1"></a>nhefs <span class="ot">&lt;-</span> nhefs <span class="sc">%&gt;%</span></span>
<span id="cb463-3"><a href="module-6-introduction-to-causal-intference.html#cb463-3" tabindex="-1"></a>          <span class="fu">mutate</span>(<span class="at">alcoholhowmuch=</span><span class="fu">case_when</span>(</span>
<span id="cb463-4"><a href="module-6-introduction-to-causal-intference.html#cb463-4" tabindex="-1"></a>            alcoholfreq<span class="sc">==</span><span class="dv">4</span><span class="sc">~</span><span class="dv">0</span>,</span>
<span id="cb463-5"><a href="module-6-introduction-to-causal-intference.html#cb463-5" tabindex="-1"></a>            alcoholfreq<span class="sc">!=</span><span class="dv">4</span><span class="sc">~</span>alcoholhowmuch</span>
<span id="cb463-6"><a href="module-6-introduction-to-causal-intference.html#cb463-6" tabindex="-1"></a>          ))</span></code></pre></div>
<p>For the purpose of this example, we will go ahead and just remove any observations with remaining missingness in the covariates of interest. However, in real applications, I would recommend imputing these values instead as long as the variable does not exhibit too high a percentage of missingness.</p>
<div class="sourceCode" id="cb464"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb464-1"><a href="module-6-introduction-to-causal-intference.html#cb464-1" tabindex="-1"></a><span class="co"># now let&#39;s see how that improved missingness</span></span>
<span id="cb464-2"><a href="module-6-introduction-to-causal-intference.html#cb464-2" tabindex="-1"></a><span class="fu">apply</span>(nhefs,<span class="dv">2</span>,<span class="cf">function</span>(x) <span class="fu">sum</span>(<span class="fu">is.na</span>(x)))<span class="sc">/</span><span class="fu">dim</span>(nhefs)[<span class="dv">1</span>]</span></code></pre></div>
<pre><code>##              seqn              qsmk             death             yrdth 
##       0.000000000       0.000000000       0.000000000       0.804788214 
##             modth             dadth               sbp               dbp 
##       0.802332719       0.802332719       0.047268263       0.049723757 
##               sex               age              race            income 
##       0.000000000       0.000000000       0.000000000       0.038060160 
##           marital            school         education                ht 
##       0.000000000       0.000000000       0.000000000       0.000000000 
##              wt71              wt82           wt82_71        birthplace 
##       0.000000000       0.038674033       0.038674033       0.056476366 
##    smokeintensity smkintensity82_71          smokeyrs            asthma 
##       0.000000000       0.000000000       0.000000000       0.000000000 
##            bronch                tb                hf               hbp 
##       0.000000000       0.000000000       0.000000000       0.000000000 
##       pepticulcer           colitis         hepatitis      chroniccough 
##       0.000000000       0.000000000       0.000000000       0.000000000 
##          hayfever          diabetes             polio             tumor 
##       0.000000000       0.000000000       0.000000000       0.000000000 
##      nervousbreak         alcoholpy       alcoholfreq       alcoholtype 
##       0.000000000       0.000000000       0.000000000       0.000000000 
##    alcoholhowmuch              pica          headache         otherpain 
##       0.128913444       0.000000000       0.000000000       0.000000000 
##         weakheart         allergies            nerves           lackpep 
##       0.000000000       0.000000000       0.000000000       0.000000000 
##            hbpmed      boweltrouble            wtloss         infection 
##       0.000000000       0.000000000       0.000000000       0.000000000 
##            active          exercise      birthcontrol       pregnancies 
##       0.000000000       0.000000000       0.000000000       0.554327808 
##       cholesterol         hightax82           price71           price82 
##       0.009821977       0.056476366       0.056476366       0.056476366 
##             tax71             tax82        price71_82          tax71_82 
##       0.056476366       0.056476366       0.056476366       0.056476366</code></pre>
<div class="sourceCode" id="cb466"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb466-1"><a href="module-6-introduction-to-causal-intference.html#cb466-1" tabindex="-1"></a><span class="co"># removing missing data for the purpose of example</span></span>
<span id="cb466-2"><a href="module-6-introduction-to-causal-intference.html#cb466-2" tabindex="-1"></a>nhefs_c <span class="ot">&lt;-</span> nhefs <span class="sc">%&gt;%</span></span>
<span id="cb466-3"><a href="module-6-introduction-to-causal-intference.html#cb466-3" tabindex="-1"></a>  <span class="fu">drop_na</span>(qsmk, sex, race, age, education, smokeintensity, smokeyrs, </span>
<span id="cb466-4"><a href="module-6-introduction-to-causal-intference.html#cb466-4" tabindex="-1"></a>          exercise, active, wt71)</span></code></pre></div>
</div>
<div id="looking-at-balance" class="section level4 hasAnchor">
<h4>Looking at Balance<a href="module-6-introduction-to-causal-intference.html#looking-at-balance" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Given that this dataset comes from an observational study, we should assess whether the covariates are balanced across our exposure groups (quit smoking/did not quit). To do this, we can use the cobalt package in R which has helpful functions bal.tab() and bal.plot().</p>
<div class="sourceCode" id="cb467"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb467-1"><a href="module-6-introduction-to-causal-intference.html#cb467-1" tabindex="-1"></a><span class="co"># For bal.tab, we can supply it with our propensity score formula</span></span>
<span id="cb467-2"><a href="module-6-introduction-to-causal-intference.html#cb467-2" tabindex="-1"></a><span class="fu">bal.tab</span>(qsmk <span class="sc">~</span> sex <span class="sc">+</span> race <span class="sc">+</span> age <span class="sc">+</span> education</span>
<span id="cb467-3"><a href="module-6-introduction-to-causal-intference.html#cb467-3" tabindex="-1"></a>        <span class="sc">+</span> smokeintensity <span class="sc">+</span> smokeyrs</span>
<span id="cb467-4"><a href="module-6-introduction-to-causal-intference.html#cb467-4" tabindex="-1"></a>        <span class="sc">+</span> exercise <span class="sc">+</span> active</span>
<span id="cb467-5"><a href="module-6-introduction-to-causal-intference.html#cb467-5" tabindex="-1"></a>        <span class="sc">+</span> wt71, <span class="at">data =</span> nhefs, <span class="at">m.threshold=</span><span class="fl">0.1</span>)</span></code></pre></div>
<pre><code>## Note: `s.d.denom` not specified; assuming &quot;pooled&quot;.</code></pre>
<pre><code>## Balance Measures
##                   Type Diff.Un     M.Threshold.Un
## sex             Binary -0.0858     Balanced, &lt;0.1
## race            Binary -0.0586     Balanced, &lt;0.1
## age            Contin.  0.3089 Not Balanced, &gt;0.1
## education_1     Binary  0.0358     Balanced, &lt;0.1
## education_2     Binary -0.0451     Balanced, &lt;0.1
## education_3     Binary -0.0290     Balanced, &lt;0.1
## education_4     Binary -0.0098     Balanced, &lt;0.1
## education_5     Binary  0.0481     Balanced, &lt;0.1
## smokeintensity Contin. -0.1999 Not Balanced, &gt;0.1
## smokeyrs       Contin.  0.1895 Not Balanced, &gt;0.1
## exercise_0      Binary -0.0421     Balanced, &lt;0.1
## exercise_1      Binary  0.0099     Balanced, &lt;0.1
## exercise_2      Binary  0.0322     Balanced, &lt;0.1
## active_0        Binary -0.0302     Balanced, &lt;0.1
## active_1        Binary  0.0130     Balanced, &lt;0.1
## active_2        Binary  0.0172     Balanced, &lt;0.1
## wt71           Contin.  0.1354 Not Balanced, &gt;0.1
## 
## Balance tally for mean differences
##                    count
## Balanced, &lt;0.1        13
## Not Balanced, &gt;0.1     4
## 
## Variable with the greatest mean difference
##  Variable Diff.Un     M.Threshold.Un
##       age  0.3089 Not Balanced, &gt;0.1
## 
## Sample sizes
##     Control Treated
## All    1201     428</code></pre>
<div class="sourceCode" id="cb470"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb470-1"><a href="module-6-introduction-to-causal-intference.html#cb470-1" tabindex="-1"></a><span class="co"># alternatively, we can visualize the balance with bal.plot()</span></span>
<span id="cb470-2"><a href="module-6-introduction-to-causal-intference.html#cb470-2" tabindex="-1"></a><span class="co"># sex plot</span></span>
<span id="cb470-3"><a href="module-6-introduction-to-causal-intference.html#cb470-3" tabindex="-1"></a><span class="fu">bal.plot</span>(qsmk <span class="sc">~</span> sex <span class="sc">+</span> race <span class="sc">+</span> age <span class="sc">+</span> education</span>
<span id="cb470-4"><a href="module-6-introduction-to-causal-intference.html#cb470-4" tabindex="-1"></a>         <span class="sc">+</span> smokeintensity <span class="sc">+</span> smokeyrs</span>
<span id="cb470-5"><a href="module-6-introduction-to-causal-intference.html#cb470-5" tabindex="-1"></a>         <span class="sc">+</span> exercise <span class="sc">+</span> active</span>
<span id="cb470-6"><a href="module-6-introduction-to-causal-intference.html#cb470-6" tabindex="-1"></a>         <span class="sc">+</span> wt71, <span class="at">data =</span> nhefs, <span class="at">var.name =</span> <span class="st">&quot;sex&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-146-1.png" width="672" /></p>
<div class="sourceCode" id="cb471"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb471-1"><a href="module-6-introduction-to-causal-intference.html#cb471-1" tabindex="-1"></a><span class="co"># age plot</span></span>
<span id="cb471-2"><a href="module-6-introduction-to-causal-intference.html#cb471-2" tabindex="-1"></a><span class="fu">bal.plot</span>(qsmk <span class="sc">~</span> sex <span class="sc">+</span> race <span class="sc">+</span> age <span class="sc">+</span> education</span>
<span id="cb471-3"><a href="module-6-introduction-to-causal-intference.html#cb471-3" tabindex="-1"></a>         <span class="sc">+</span> smokeintensity <span class="sc">+</span> smokeyrs</span>
<span id="cb471-4"><a href="module-6-introduction-to-causal-intference.html#cb471-4" tabindex="-1"></a>         <span class="sc">+</span> exercise <span class="sc">+</span> active</span>
<span id="cb471-5"><a href="module-6-introduction-to-causal-intference.html#cb471-5" tabindex="-1"></a>         <span class="sc">+</span> wt71, <span class="at">data =</span> nhefs, <span class="at">var.name =</span> <span class="st">&quot;age&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-146-2.png" width="672" /></p>
</div>
<div id="propensity-score-estimation" class="section level4 hasAnchor">
<h4>Propensity Score Estimation<a href="module-6-introduction-to-causal-intference.html#propensity-score-estimation" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>We can estimate propensity scores for binary treatment variables using some of the methods we have learned in this course including logistic regression and random forest.</p>
<div id="logistic-regression-1" class="section level5 hasAnchor">
<h5>Logistic Regression<a href="module-6-introduction-to-causal-intference.html#logistic-regression-1" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<div class="sourceCode" id="cb472"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb472-1"><a href="module-6-introduction-to-causal-intference.html#cb472-1" tabindex="-1"></a><span class="co"># fit the logistic regression</span></span>
<span id="cb472-2"><a href="module-6-introduction-to-causal-intference.html#cb472-2" tabindex="-1"></a>fit1 <span class="ot">&lt;-</span> <span class="fu">glm</span>(qsmk <span class="sc">~</span> sex <span class="sc">+</span> race <span class="sc">+</span> age <span class="sc">+</span> education</span>
<span id="cb472-3"><a href="module-6-introduction-to-causal-intference.html#cb472-3" tabindex="-1"></a>            <span class="sc">+</span> smokeintensity <span class="sc">+</span> smokeyrs</span>
<span id="cb472-4"><a href="module-6-introduction-to-causal-intference.html#cb472-4" tabindex="-1"></a>             <span class="sc">+</span> exercise <span class="sc">+</span> active</span>
<span id="cb472-5"><a href="module-6-introduction-to-causal-intference.html#cb472-5" tabindex="-1"></a>            <span class="sc">+</span> wt71, <span class="at">data=</span>nhefs, <span class="at">family=</span><span class="fu">binomial</span>())</span>
<span id="cb472-6"><a href="module-6-introduction-to-causal-intference.html#cb472-6" tabindex="-1"></a><span class="fu">summary</span>(fit1)</span></code></pre></div>
<pre><code>## 
## Call:
## glm(formula = qsmk ~ sex + race + age + education + smokeintensity + 
##     smokeyrs + exercise + active + wt71, family = binomial(), 
##     data = nhefs)
## 
## Coefficients:
##                 Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)    -2.385073   0.466849  -5.109 3.24e-07 ***
## sex            -0.488430   0.141643  -3.448 0.000564 ***
## race           -0.787093   0.202422  -3.888 0.000101 ***
## age             0.047264   0.009642   4.902 9.48e-07 ***
## education2     -0.134815   0.188703  -0.714 0.474963    
## education3     -0.015591   0.168500  -0.093 0.926278    
## education4     -0.006856   0.261048  -0.026 0.979047    
## education5      0.373307   0.218472   1.709 0.087503 .  
## smokeintensity -0.024142   0.005461  -4.421 9.83e-06 ***
## smokeyrs       -0.027736   0.009736  -2.849 0.004386 ** 
## exercise1       0.292749   0.172534   1.697 0.089742 .  
## exercise2       0.375542   0.178809   2.100 0.035708 *  
## active1         0.021673   0.128655   0.168 0.866222    
## active2         0.072929   0.207047   0.352 0.724663    
## wt71            0.006345   0.004134   1.535 0.124785    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 1876.3  on 1628  degrees of freedom
## Residual deviance: 1780.6  on 1614  degrees of freedom
## AIC: 1810.6
## 
## Number of Fisher Scoring iterations: 4</code></pre>
<div class="sourceCode" id="cb474"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb474-1"><a href="module-6-introduction-to-causal-intference.html#cb474-1" tabindex="-1"></a><span class="co"># do we need any polynomial terms or transformations?</span></span>
<span id="cb474-2"><a href="module-6-introduction-to-causal-intference.html#cb474-2" tabindex="-1"></a><span class="fu">crPlot</span>(fit1, <span class="at">variable=</span><span class="st">&quot;smokeintensity&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-147-1.png" width="672" /></p>
<div class="sourceCode" id="cb475"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb475-1"><a href="module-6-introduction-to-causal-intference.html#cb475-1" tabindex="-1"></a><span class="fu">crPlot</span>(fit1, <span class="at">variable=</span><span class="st">&quot;age&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-147-2.png" width="672" /></p>
<div class="sourceCode" id="cb476"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb476-1"><a href="module-6-introduction-to-causal-intference.html#cb476-1" tabindex="-1"></a><span class="fu">crPlot</span>(fit1, <span class="at">variable=</span><span class="st">&quot;smokeyrs&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-147-3.png" width="672" /></p>
<div class="sourceCode" id="cb477"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb477-1"><a href="module-6-introduction-to-causal-intference.html#cb477-1" tabindex="-1"></a><span class="fu">crPlot</span>(fit1, <span class="at">variable=</span><span class="st">&quot;wt71&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-147-4.png" width="672" /></p>
<div class="sourceCode" id="cb478"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb478-1"><a href="module-6-introduction-to-causal-intference.html#cb478-1" tabindex="-1"></a><span class="co"># now extract the propensity score (i.e., predicted probability of quitting smoking)</span></span>
<span id="cb478-2"><a href="module-6-introduction-to-causal-intference.html#cb478-2" tabindex="-1"></a>ps_log1 <span class="ot">&lt;-</span> <span class="fu">predict</span>(fit1, nhefs, <span class="at">type=</span><span class="st">&quot;response&quot;</span>)</span></code></pre></div>
<p>We can also estimate these propensity scores with the matchit function from the MatchIt package, which will fit the logistic model for us. We can let it know to estimate propensity scores by setting distance = “glm”.</p>
<div class="sourceCode" id="cb479"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb479-1"><a href="module-6-introduction-to-causal-intference.html#cb479-1" tabindex="-1"></a><span class="co"># we set method = NULL so that no matching will occur</span></span>
<span id="cb479-2"><a href="module-6-introduction-to-causal-intference.html#cb479-2" tabindex="-1"></a>m.out0 <span class="ot">&lt;-</span> <span class="fu">matchit</span>(qsmk <span class="sc">~</span> sex <span class="sc">+</span> race <span class="sc">+</span> age <span class="sc">+</span> education</span>
<span id="cb479-3"><a href="module-6-introduction-to-causal-intference.html#cb479-3" tabindex="-1"></a>                  <span class="sc">+</span> smokeintensity <span class="sc">+</span>  smokeyrs <span class="sc">+</span></span>
<span id="cb479-4"><a href="module-6-introduction-to-causal-intference.html#cb479-4" tabindex="-1"></a>                    exercise <span class="sc">+</span> active</span>
<span id="cb479-5"><a href="module-6-introduction-to-causal-intference.html#cb479-5" tabindex="-1"></a>                  <span class="sc">+</span> wt71, <span class="at">data=</span>nhefs,</span>
<span id="cb479-6"><a href="module-6-introduction-to-causal-intference.html#cb479-6" tabindex="-1"></a>                  <span class="at">method =</span> <span class="cn">NULL</span>, <span class="at">distance =</span> <span class="st">&quot;glm&quot;</span>)</span>
<span id="cb479-7"><a href="module-6-introduction-to-causal-intference.html#cb479-7" tabindex="-1"></a></span>
<span id="cb479-8"><a href="module-6-introduction-to-causal-intference.html#cb479-8" tabindex="-1"></a>ps_log2 <span class="ot">&lt;-</span> m.out0<span class="sc">$</span>distance</span></code></pre></div>
<p>What do our propensity scores look like? Let’s first see if the propensity scores we found are the same as those found by matchit. Then we can plot the distribution of the propensity score within each treatment group.</p>
<div class="sourceCode" id="cb480"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb480-1"><a href="module-6-introduction-to-causal-intference.html#cb480-1" tabindex="-1"></a><span class="co"># are propensity scores equal between logistic and matchit?</span></span>
<span id="cb480-2"><a href="module-6-introduction-to-causal-intference.html#cb480-2" tabindex="-1"></a><span class="fu">sum</span>(ps_log1<span class="sc">==</span>ps_log2)</span></code></pre></div>
<pre><code>## [1] 1629</code></pre>
<div class="sourceCode" id="cb482"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb482-1"><a href="module-6-introduction-to-causal-intference.html#cb482-1" tabindex="-1"></a><span class="co"># let&#39;s add this propensity score to nhefs as &quot;ps_log&quot;</span></span>
<span id="cb482-2"><a href="module-6-introduction-to-causal-intference.html#cb482-2" tabindex="-1"></a>nhefs<span class="sc">$</span>ps_log <span class="ot">&lt;-</span> ps_log1</span>
<span id="cb482-3"><a href="module-6-introduction-to-causal-intference.html#cb482-3" tabindex="-1"></a></span>
<span id="cb482-4"><a href="module-6-introduction-to-causal-intference.html#cb482-4" tabindex="-1"></a><span class="co"># plot of distribution of propensity scores within each treatment</span></span>
<span id="cb482-5"><a href="module-6-introduction-to-causal-intference.html#cb482-5" tabindex="-1"></a><span class="co"># compare distributions of propensity scores for each group</span></span>
<span id="cb482-6"><a href="module-6-introduction-to-causal-intference.html#cb482-6" tabindex="-1"></a><span class="fu">ggplot</span>(nhefs, <span class="fu">aes</span>(<span class="at">x =</span> ps_log, <span class="at">group =</span> <span class="fu">as.factor</span>(qsmk), <span class="at">fill=</span><span class="fu">as.factor</span>(qsmk))) <span class="sc">+</span></span>
<span id="cb482-7"><a href="module-6-introduction-to-causal-intference.html#cb482-7" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">position =</span> <span class="st">&quot;stack&quot;</span>, <span class="at">bins =</span> <span class="dv">30</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb482-8"><a href="module-6-introduction-to-causal-intference.html#cb482-8" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb482-9"><a href="module-6-introduction-to-causal-intference.html#cb482-9" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">&quot;Stacked Histogram of Propensity Scores by Treatment Group&quot;</span>,</span>
<span id="cb482-10"><a href="module-6-introduction-to-causal-intference.html#cb482-10" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;Propensity Score&quot;</span>,</span>
<span id="cb482-11"><a href="module-6-introduction-to-causal-intference.html#cb482-11" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">&quot;Count&quot;</span>,</span>
<span id="cb482-12"><a href="module-6-introduction-to-causal-intference.html#cb482-12" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">&quot;Quit Smoking?&quot;</span></span>
<span id="cb482-13"><a href="module-6-introduction-to-causal-intference.html#cb482-13" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb482-14"><a href="module-6-introduction-to-causal-intference.html#cb482-14" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-149-1.png" width="672" /></p>
</div>
</div>
<div id="random-forest" class="section level4 hasAnchor">
<h4>Random Forest<a href="module-6-introduction-to-causal-intference.html#random-forest" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Let’s fit a random forest model instead to calculate the propensity scores.</p>
<div class="sourceCode" id="cb483"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb483-1"><a href="module-6-introduction-to-causal-intference.html#cb483-1" tabindex="-1"></a><span class="co"># Fit the random forest model</span></span>
<span id="cb483-2"><a href="module-6-introduction-to-causal-intference.html#cb483-2" tabindex="-1"></a>rf_model <span class="ot">&lt;-</span> <span class="fu">randomForest</span>(<span class="fu">as.factor</span>(qsmk) <span class="sc">~</span> sex <span class="sc">+</span> race <span class="sc">+</span> age <span class="sc">+</span> education</span>
<span id="cb483-3"><a href="module-6-introduction-to-causal-intference.html#cb483-3" tabindex="-1"></a>                  <span class="sc">+</span> smokeintensity <span class="sc">+</span>  smokeyrs <span class="sc">+</span></span>
<span id="cb483-4"><a href="module-6-introduction-to-causal-intference.html#cb483-4" tabindex="-1"></a>                    exercise <span class="sc">+</span> active</span>
<span id="cb483-5"><a href="module-6-introduction-to-causal-intference.html#cb483-5" tabindex="-1"></a>                  <span class="sc">+</span> wt71, <span class="at">data=</span>nhefs)</span>
<span id="cb483-6"><a href="module-6-introduction-to-causal-intference.html#cb483-6" tabindex="-1"></a></span>
<span id="cb483-7"><a href="module-6-introduction-to-causal-intference.html#cb483-7" tabindex="-1"></a><span class="co"># Print the model summary</span></span>
<span id="cb483-8"><a href="module-6-introduction-to-causal-intference.html#cb483-8" tabindex="-1"></a><span class="fu">print</span>(rf_model)</span></code></pre></div>
<pre><code>## 
## Call:
##  randomForest(formula = as.factor(qsmk) ~ sex + race + age + education +      smokeintensity + smokeyrs + exercise + active + wt71, data = nhefs) 
##                Type of random forest: classification
##                      Number of trees: 500
## No. of variables tried at each split: 3
## 
##         OOB estimate of  error rate: 29.04%
## Confusion matrix:
##      0  1 class.error
## 0 1115 86  0.07160699
## 1  387 41  0.90420561</code></pre>
<div class="sourceCode" id="cb485"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb485-1"><a href="module-6-introduction-to-causal-intference.html#cb485-1" tabindex="-1"></a><span class="co"># calculate propensity scores</span></span>
<span id="cb485-2"><a href="module-6-introduction-to-causal-intference.html#cb485-2" tabindex="-1"></a>ps_rf1 <span class="ot">&lt;-</span> <span class="fu">predict</span>(rf_model, <span class="at">type=</span><span class="st">&quot;prob&quot;</span>)[,<span class="dv">2</span>]</span></code></pre></div>
<p>Again, we can use the matchit function to fit this random forest for us by setting distance=“randomforest”.</p>
<div class="sourceCode" id="cb486"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb486-1"><a href="module-6-introduction-to-causal-intference.html#cb486-1" tabindex="-1"></a><span class="co"># we set method = NULL so that no matching will occur</span></span>
<span id="cb486-2"><a href="module-6-introduction-to-causal-intference.html#cb486-2" tabindex="-1"></a>m.out.rf <span class="ot">&lt;-</span> <span class="fu">matchit</span>(qsmk <span class="sc">~</span> sex <span class="sc">+</span> race <span class="sc">+</span> age <span class="sc">+</span> education</span>
<span id="cb486-3"><a href="module-6-introduction-to-causal-intference.html#cb486-3" tabindex="-1"></a>                  <span class="sc">+</span> smokeintensity <span class="sc">+</span>  smokeyrs <span class="sc">+</span></span>
<span id="cb486-4"><a href="module-6-introduction-to-causal-intference.html#cb486-4" tabindex="-1"></a>                    exercise <span class="sc">+</span> active</span>
<span id="cb486-5"><a href="module-6-introduction-to-causal-intference.html#cb486-5" tabindex="-1"></a>                  <span class="sc">+</span> wt71, <span class="at">data=</span>nhefs,</span>
<span id="cb486-6"><a href="module-6-introduction-to-causal-intference.html#cb486-6" tabindex="-1"></a>                  <span class="at">method =</span> <span class="cn">NULL</span>, <span class="at">distance =</span> <span class="st">&quot;randomforest&quot;</span>)</span>
<span id="cb486-7"><a href="module-6-introduction-to-causal-intference.html#cb486-7" tabindex="-1"></a></span>
<span id="cb486-8"><a href="module-6-introduction-to-causal-intference.html#cb486-8" tabindex="-1"></a>ps_rf2 <span class="ot">&lt;-</span> m.out.rf<span class="sc">$</span>distance</span></code></pre></div>
<p>Let’s compare the propensity scores calculated via our random forest and the random forest in matchit.</p>
<div class="sourceCode" id="cb487"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb487-1"><a href="module-6-introduction-to-causal-intference.html#cb487-1" tabindex="-1"></a><span class="co"># are propensity scores equal between our rf and matchit?</span></span>
<span id="cb487-2"><a href="module-6-introduction-to-causal-intference.html#cb487-2" tabindex="-1"></a><span class="fu">sum</span>(ps_rf1<span class="sc">==</span>ps_rf2)</span></code></pre></div>
<pre><code>## [1] 3</code></pre>
<div class="sourceCode" id="cb489"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb489-1"><a href="module-6-introduction-to-causal-intference.html#cb489-1" tabindex="-1"></a><span class="co"># let&#39;s add this propensity score to nhefs as &quot;ps_rf&quot;</span></span>
<span id="cb489-2"><a href="module-6-introduction-to-causal-intference.html#cb489-2" tabindex="-1"></a>nhefs<span class="sc">$</span>ps_rf <span class="ot">&lt;-</span> ps_rf1</span>
<span id="cb489-3"><a href="module-6-introduction-to-causal-intference.html#cb489-3" tabindex="-1"></a></span>
<span id="cb489-4"><a href="module-6-introduction-to-causal-intference.html#cb489-4" tabindex="-1"></a><span class="co"># plot of distribution of propensity scores within each treatment</span></span>
<span id="cb489-5"><a href="module-6-introduction-to-causal-intference.html#cb489-5" tabindex="-1"></a><span class="co"># compare distributions of propensity scores for each group</span></span>
<span id="cb489-6"><a href="module-6-introduction-to-causal-intference.html#cb489-6" tabindex="-1"></a><span class="fu">ggplot</span>(nhefs, <span class="fu">aes</span>(<span class="at">x =</span> ps_rf, <span class="at">group =</span> <span class="fu">as.factor</span>(qsmk), <span class="at">fill=</span><span class="fu">as.factor</span>(qsmk))) <span class="sc">+</span></span>
<span id="cb489-7"><a href="module-6-introduction-to-causal-intference.html#cb489-7" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">position =</span> <span class="st">&quot;stack&quot;</span>, <span class="at">bins =</span> <span class="dv">30</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb489-8"><a href="module-6-introduction-to-causal-intference.html#cb489-8" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb489-9"><a href="module-6-introduction-to-causal-intference.html#cb489-9" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">&quot;Stacked Histogram of Propensity Scores by Treatment Group&quot;</span>,</span>
<span id="cb489-10"><a href="module-6-introduction-to-causal-intference.html#cb489-10" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;Propensity Score&quot;</span>,</span>
<span id="cb489-11"><a href="module-6-introduction-to-causal-intference.html#cb489-11" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">&quot;Count&quot;</span>,</span>
<span id="cb489-12"><a href="module-6-introduction-to-causal-intference.html#cb489-12" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">&quot;Quit Smoking?&quot;</span></span>
<span id="cb489-13"><a href="module-6-introduction-to-causal-intference.html#cb489-13" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb489-14"><a href="module-6-introduction-to-causal-intference.html#cb489-14" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-152-1.png" width="672" /></p>
<p>Why are the propensity scores different for the random forest? Because of the ‘random’ part of random forest. We could have used set.seed() to avoid this.</p>
</div>
<div id="accounting-for-propensity-scores" class="section level4 hasAnchor">
<h4>Accounting for Propensity Scores<a href="module-6-introduction-to-causal-intference.html#accounting-for-propensity-scores" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Now that we have our propensity scores we can use them in our analysis to estimate the causal effect of quitting smoking on weight gain.</p>
<div id="matching" class="section level5 hasAnchor">
<h5>Matching<a href="module-6-introduction-to-causal-intference.html#matching" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>First, we will look at an example of matching. The matchit function can conduct nearest matching for us by setting the method=“nearest”.</p>
<div class="sourceCode" id="cb490"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb490-1"><a href="module-6-introduction-to-causal-intference.html#cb490-1" tabindex="-1"></a><span class="co"># we can set distance to a propensity score method as we did previously:</span></span>
<span id="cb490-2"><a href="module-6-introduction-to-causal-intference.html#cb490-2" tabindex="-1"></a>m.out1 <span class="ot">&lt;-</span> <span class="fu">matchit</span>(qsmk <span class="sc">~</span> sex <span class="sc">+</span> race <span class="sc">+</span> age <span class="sc">+</span> education</span>
<span id="cb490-3"><a href="module-6-introduction-to-causal-intference.html#cb490-3" tabindex="-1"></a>                  <span class="sc">+</span> smokeintensity <span class="sc">+</span>  smokeyrs <span class="sc">+</span></span>
<span id="cb490-4"><a href="module-6-introduction-to-causal-intference.html#cb490-4" tabindex="-1"></a>                    exercise <span class="sc">+</span> active</span>
<span id="cb490-5"><a href="module-6-introduction-to-causal-intference.html#cb490-5" tabindex="-1"></a>                  <span class="sc">+</span> wt71, <span class="at">data=</span>nhefs,</span>
<span id="cb490-6"><a href="module-6-introduction-to-causal-intference.html#cb490-6" tabindex="-1"></a>                  <span class="at">method =</span> <span class="st">&quot;nearest&quot;</span>, <span class="at">distance =</span> <span class="st">&quot;glm&quot;</span>)</span>
<span id="cb490-7"><a href="module-6-introduction-to-causal-intference.html#cb490-7" tabindex="-1"></a>m.out1 <span class="co"># notice that our matched sample is quite a bit smaller</span></span></code></pre></div>
<pre><code>## A `matchit` object
##  - method: 1:1 nearest neighbor matching without replacement
##  - distance: Propensity score
##              - estimated with logistic regression
##  - number of obs.: 1629 (original), 856 (matched)
##  - target estimand: ATT
##  - covariates: sex, race, age, education, smokeintensity, smokeyrs, exercise, active, wt71</code></pre>
<div class="sourceCode" id="cb492"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb492-1"><a href="module-6-introduction-to-causal-intference.html#cb492-1" tabindex="-1"></a><span class="co"># or we can set distance to a pre-calculated propensity score:</span></span>
<span id="cb492-2"><a href="module-6-introduction-to-causal-intference.html#cb492-2" tabindex="-1"></a>m.out2 <span class="ot">&lt;-</span> <span class="fu">matchit</span>(qsmk <span class="sc">~</span> sex <span class="sc">+</span> race <span class="sc">+</span> age <span class="sc">+</span> education</span>
<span id="cb492-3"><a href="module-6-introduction-to-causal-intference.html#cb492-3" tabindex="-1"></a>                  <span class="sc">+</span> smokeintensity <span class="sc">+</span>  smokeyrs <span class="sc">+</span></span>
<span id="cb492-4"><a href="module-6-introduction-to-causal-intference.html#cb492-4" tabindex="-1"></a>                    exercise <span class="sc">+</span> active</span>
<span id="cb492-5"><a href="module-6-introduction-to-causal-intference.html#cb492-5" tabindex="-1"></a>                  <span class="sc">+</span> wt71, <span class="at">data=</span>nhefs,</span>
<span id="cb492-6"><a href="module-6-introduction-to-causal-intference.html#cb492-6" tabindex="-1"></a>                  <span class="at">method =</span> <span class="st">&quot;nearest&quot;</span>, <span class="at">distance =</span> nhefs<span class="sc">$</span>ps_rf)</span>
<span id="cb492-7"><a href="module-6-introduction-to-causal-intference.html#cb492-7" tabindex="-1"></a>m.out2 <span class="co"># notice that our matched sample is quite a bit smaller</span></span></code></pre></div>
<pre><code>## A `matchit` object
##  - method: 1:1 nearest neighbor matching without replacement
##  - distance: User-defined - number of obs.: 1629 (original), 856 (matched)
##  - target estimand: ATT
##  - covariates: sex, race, age, education, smokeintensity, smokeyrs, exercise, active, wt71</code></pre>
<p>Now we can re-check the covariate balance in our new matched sample.</p>
<div class="sourceCode" id="cb494"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb494-1"><a href="module-6-introduction-to-causal-intference.html#cb494-1" tabindex="-1"></a><span class="co"># 1. for logistic regression propensity score</span></span>
<span id="cb494-2"><a href="module-6-introduction-to-causal-intference.html#cb494-2" tabindex="-1"></a><span class="co"># covariate balance summary table</span></span>
<span id="cb494-3"><a href="module-6-introduction-to-causal-intference.html#cb494-3" tabindex="-1"></a><span class="fu">bal.tab</span>(m.out1, <span class="at">m.threshold=</span><span class="fl">0.1</span>)</span></code></pre></div>
<pre><code>## Balance Measures
##                    Type Diff.Adj    M.Threshold
## distance       Distance   0.0325 Balanced, &lt;0.1
## sex              Binary  -0.0070 Balanced, &lt;0.1
## race             Binary   0.0140 Balanced, &lt;0.1
## age             Contin.   0.0112 Balanced, &lt;0.1
## education_1      Binary   0.0304 Balanced, &lt;0.1
## education_2      Binary   0.0140 Balanced, &lt;0.1
## education_3      Binary  -0.0374 Balanced, &lt;0.1
## education_4      Binary  -0.0047 Balanced, &lt;0.1
## education_5      Binary  -0.0023 Balanced, &lt;0.1
## smokeintensity  Contin.  -0.0358 Balanced, &lt;0.1
## smokeyrs        Contin.   0.0192 Balanced, &lt;0.1
## exercise_0       Binary  -0.0280 Balanced, &lt;0.1
## exercise_1       Binary  -0.0140 Balanced, &lt;0.1
## exercise_2       Binary   0.0421 Balanced, &lt;0.1
## active_0         Binary  -0.0187 Balanced, &lt;0.1
## active_1         Binary   0.0187 Balanced, &lt;0.1
## active_2         Binary   0.0000 Balanced, &lt;0.1
## wt71            Contin.   0.0260 Balanced, &lt;0.1
## 
## Balance tally for mean differences
##                    count
## Balanced, &lt;0.1        18
## Not Balanced, &gt;0.1     0
## 
## Variable with the greatest mean difference
##    Variable Diff.Adj    M.Threshold
##  exercise_2   0.0421 Balanced, &lt;0.1
## 
## Sample sizes
##           Control Treated
## All          1201     428
## Matched       428     428
## Unmatched     773       0</code></pre>
<div class="sourceCode" id="cb496"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb496-1"><a href="module-6-introduction-to-causal-intference.html#cb496-1" tabindex="-1"></a><span class="co"># covariate balance plots</span></span>
<span id="cb496-2"><a href="module-6-introduction-to-causal-intference.html#cb496-2" tabindex="-1"></a><span class="fu">bal.plot</span>(m.out1, <span class="at">var.name =</span> <span class="st">&quot;sex&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-154-1.png" width="672" /></p>
<div class="sourceCode" id="cb497"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb497-1"><a href="module-6-introduction-to-causal-intference.html#cb497-1" tabindex="-1"></a><span class="fu">bal.plot</span>(m.out1, <span class="at">var.name =</span> <span class="st">&quot;smokeyrs&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-154-2.png" width="672" /></p>
<div class="sourceCode" id="cb498"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb498-1"><a href="module-6-introduction-to-causal-intference.html#cb498-1" tabindex="-1"></a><span class="co"># 2. for random forest propensity score</span></span>
<span id="cb498-2"><a href="module-6-introduction-to-causal-intference.html#cb498-2" tabindex="-1"></a><span class="co"># covariate balance summary table</span></span>
<span id="cb498-3"><a href="module-6-introduction-to-causal-intference.html#cb498-3" tabindex="-1"></a><span class="fu">bal.tab</span>(m.out2, <span class="at">m.threshold=</span><span class="fl">0.1</span>)</span></code></pre></div>
<pre><code>## Balance Measures
##                    Type Diff.Adj        M.Threshold
## distance       Distance   0.0017     Balanced, &lt;0.1
## sex              Binary  -0.0397     Balanced, &lt;0.1
## race             Binary  -0.0561     Balanced, &lt;0.1
## age             Contin.   0.2266 Not Balanced, &gt;0.1
## education_1      Binary   0.0117     Balanced, &lt;0.1
## education_2      Binary  -0.0047     Balanced, &lt;0.1
## education_3      Binary  -0.0280     Balanced, &lt;0.1
## education_4      Binary  -0.0070     Balanced, &lt;0.1
## education_5      Binary   0.0280     Balanced, &lt;0.1
## smokeintensity  Contin.  -0.1660 Not Balanced, &gt;0.1
## smokeyrs        Contin.   0.1465 Not Balanced, &gt;0.1
## exercise_0       Binary  -0.0350     Balanced, &lt;0.1
## exercise_1       Binary   0.0257     Balanced, &lt;0.1
## exercise_2       Binary   0.0093     Balanced, &lt;0.1
## active_0         Binary   0.0023     Balanced, &lt;0.1
## active_1         Binary  -0.0164     Balanced, &lt;0.1
## active_2         Binary   0.0140     Balanced, &lt;0.1
## wt71            Contin.   0.0820     Balanced, &lt;0.1
## 
## Balance tally for mean differences
##                    count
## Balanced, &lt;0.1        15
## Not Balanced, &gt;0.1     3
## 
## Variable with the greatest mean difference
##  Variable Diff.Adj        M.Threshold
##       age   0.2266 Not Balanced, &gt;0.1
## 
## Sample sizes
##           Control Treated
## All          1201     428
## Matched       428     428
## Unmatched     773       0</code></pre>
<div class="sourceCode" id="cb500"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb500-1"><a href="module-6-introduction-to-causal-intference.html#cb500-1" tabindex="-1"></a><span class="co"># covariate balance plots</span></span>
<span id="cb500-2"><a href="module-6-introduction-to-causal-intference.html#cb500-2" tabindex="-1"></a><span class="fu">bal.plot</span>(m.out2, <span class="at">var.name =</span> <span class="st">&quot;sex&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-154-3.png" width="672" /></p>
<div class="sourceCode" id="cb501"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb501-1"><a href="module-6-introduction-to-causal-intference.html#cb501-1" tabindex="-1"></a><span class="fu">bal.plot</span>(m.out2, <span class="at">var.name =</span> <span class="st">&quot;smokeyrs&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-154-4.png" width="672" /></p>
<p>It looks like our logistic regression did a better job of correcting the balance between those who quit smoking and those who did not so we will continue with this option.</p>
<p>Now let’s estimate the effect of quitting smoking on weight gain in the matched sample from m.out1.</p>
<div class="sourceCode" id="cb502"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb502-1"><a href="module-6-introduction-to-causal-intference.html#cb502-1" tabindex="-1"></a><span class="co"># extract the matched data</span></span>
<span id="cb502-2"><a href="module-6-introduction-to-causal-intference.html#cb502-2" tabindex="-1"></a>matched <span class="ot">&lt;-</span> <span class="fu">match.data</span>(m.out1)</span>
<span id="cb502-3"><a href="module-6-introduction-to-causal-intference.html#cb502-3" tabindex="-1"></a></span>
<span id="cb502-4"><a href="module-6-introduction-to-causal-intference.html#cb502-4" tabindex="-1"></a><span class="co"># estimate ATT with linear regression model</span></span>
<span id="cb502-5"><a href="module-6-introduction-to-causal-intference.html#cb502-5" tabindex="-1"></a>match_lm <span class="ot">&lt;-</span> <span class="fu">lm</span>(wt82_71<span class="sc">~</span>qsmk, <span class="at">data=</span>matched)</span>
<span id="cb502-6"><a href="module-6-introduction-to-causal-intference.html#cb502-6" tabindex="-1"></a><span class="fu">summary</span>(match_lm) <span class="co"># significant treatment effect in matched sample</span></span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = wt82_71 ~ qsmk, data = matched)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -30.327  -4.120  -0.171   4.478  42.986 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)   1.3014     0.3911   3.327 0.000916 ***
## qsmk          3.2236     0.5572   5.785 1.03e-08 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 7.968 on 816 degrees of freedom
##   (38 observations deleted due to missingness)
## Multiple R-squared:  0.0394, Adjusted R-squared:  0.03822 
## F-statistic: 33.47 on 1 and 816 DF,  p-value: 1.033e-08</code></pre>
<p>We could also go ahead and conduct our model diagnostics here to make sure that our model fits the data well.</p>
<div class="sourceCode" id="cb504"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb504-1"><a href="module-6-introduction-to-causal-intference.html#cb504-1" tabindex="-1"></a><span class="co"># normality</span></span>
<span id="cb504-2"><a href="module-6-introduction-to-causal-intference.html#cb504-2" tabindex="-1"></a><span class="fu">qqPlot</span>(<span class="fu">residuals</span>(match_lm))</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-156-1.png" width="672" /></p>
<pre><code>## 260 213 
## 139 114</code></pre>
<div class="sourceCode" id="cb506"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb506-1"><a href="module-6-introduction-to-causal-intference.html#cb506-1" tabindex="-1"></a><span class="co"># constant variance</span></span>
<span id="cb506-2"><a href="module-6-introduction-to-causal-intference.html#cb506-2" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">residuals</span>(match_lm)<span class="sc">~</span><span class="fu">fitted</span>(match_lm))</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-156-2.png" width="672" /></p>
<p>We see in the plots that the residuals are not normally distributed which could be due to the fact that we only have one binary predictor which does not explain our data very well (R2=0.033). We can add in some of the covariates that we think might explain our outcome better if we wanted to try and improve model fit.</p>
</div>
<div id="stratified" class="section level5 hasAnchor">
<h5>Stratified<a href="module-6-introduction-to-causal-intference.html#stratified" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>We can create strata based on the propensity scores we calculated previously. Let’s use the logistic regression propensity scores again.</p>
<div class="sourceCode" id="cb507"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb507-1"><a href="module-6-introduction-to-causal-intference.html#cb507-1" tabindex="-1"></a><span class="co"># calculation of deciles</span></span>
<span id="cb507-2"><a href="module-6-introduction-to-causal-intference.html#cb507-2" tabindex="-1"></a>nhefs<span class="sc">$</span>ps.dec <span class="ot">&lt;-</span> <span class="fu">cut</span>(nhefs<span class="sc">$</span>ps_log, </span>
<span id="cb507-3"><a href="module-6-introduction-to-causal-intference.html#cb507-3" tabindex="-1"></a>                    <span class="at">breaks=</span><span class="fu">c</span>(<span class="fu">quantile</span>(nhefs<span class="sc">$</span>ps_log, <span class="at">probs=</span><span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="fl">0.1</span>))),</span>
<span id="cb507-4"><a href="module-6-introduction-to-causal-intference.html#cb507-4" tabindex="-1"></a>                    <span class="at">labels=</span><span class="fu">seq</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>),</span>
<span id="cb507-5"><a href="module-6-introduction-to-causal-intference.html#cb507-5" tabindex="-1"></a>                    <span class="at">include.lowest=</span><span class="cn">TRUE</span>)</span>
<span id="cb507-6"><a href="module-6-introduction-to-causal-intference.html#cb507-6" tabindex="-1"></a></span>
<span id="cb507-7"><a href="module-6-introduction-to-causal-intference.html#cb507-7" tabindex="-1"></a><span class="co"># how many in each strata?</span></span>
<span id="cb507-8"><a href="module-6-introduction-to-causal-intference.html#cb507-8" tabindex="-1"></a><span class="fu">table</span>(nhefs<span class="sc">$</span>ps.dec)</span></code></pre></div>
<pre><code>## 
##   1   2   3   4   5   6   7   8   9  10 
## 163 163 163 163 163 162 163 163 163 163</code></pre>
<p>Now we want to check the balance within each strata. We can use the cluster argument in bal.tab to do this.</p>
<div class="sourceCode" id="cb509"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb509-1"><a href="module-6-introduction-to-causal-intference.html#cb509-1" tabindex="-1"></a><span class="co"># check balance within strata</span></span>
<span id="cb509-2"><a href="module-6-introduction-to-causal-intference.html#cb509-2" tabindex="-1"></a><span class="fu">bal.tab</span>(qsmk <span class="sc">~</span> sex <span class="sc">+</span> race <span class="sc">+</span> age <span class="sc">+</span> education</span>
<span id="cb509-3"><a href="module-6-introduction-to-causal-intference.html#cb509-3" tabindex="-1"></a>        <span class="sc">+</span> smokeintensity <span class="sc">+</span> smokeyrs</span>
<span id="cb509-4"><a href="module-6-introduction-to-causal-intference.html#cb509-4" tabindex="-1"></a>        <span class="sc">+</span> exercise <span class="sc">+</span> active</span>
<span id="cb509-5"><a href="module-6-introduction-to-causal-intference.html#cb509-5" tabindex="-1"></a>        <span class="sc">+</span> wt71, <span class="at">data =</span> nhefs, <span class="at">m.threshold=</span><span class="fl">0.1</span>, <span class="at">cluster=</span>nhefs<span class="sc">$</span>ps.dec)</span></code></pre></div>
<p>We can see that the balancing did not work for every strata. We can try playing around with the strata number to see if we can improve upon these results. For instance, we could use quantiles instead of deciles,</p>
<div class="sourceCode" id="cb510"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb510-1"><a href="module-6-introduction-to-causal-intference.html#cb510-1" tabindex="-1"></a>nhefs<span class="sc">$</span>ps.dec2 <span class="ot">&lt;-</span> <span class="fu">cut</span>(nhefs<span class="sc">$</span>ps_log, </span>
<span id="cb510-2"><a href="module-6-introduction-to-causal-intference.html#cb510-2" tabindex="-1"></a>                    <span class="at">breaks=</span><span class="fu">c</span>(<span class="fu">quantile</span>(nhefs<span class="sc">$</span>ps_log, <span class="at">probs=</span><span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="fl">0.2</span>))),</span>
<span id="cb510-3"><a href="module-6-introduction-to-causal-intference.html#cb510-3" tabindex="-1"></a>                    <span class="at">labels=</span><span class="fu">seq</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>),</span>
<span id="cb510-4"><a href="module-6-introduction-to-causal-intference.html#cb510-4" tabindex="-1"></a>                    <span class="at">include.lowest=</span><span class="cn">TRUE</span>)</span></code></pre></div>
<p>For now, let’s stick with our 10 initial strata and estimate the treatment effect. The first method is to look at the treatment effect within each strata. To do this, let’s conduct a t.test within each strata.</p>
<div class="sourceCode" id="cb511"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb511-1"><a href="module-6-introduction-to-causal-intference.html#cb511-1" tabindex="-1"></a><span class="co"># set up for loop for t test</span></span>
<span id="cb511-2"><a href="module-6-introduction-to-causal-intference.html#cb511-2" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>) {</span>
<span id="cb511-3"><a href="module-6-introduction-to-causal-intference.html#cb511-3" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">t.test</span>(wt82_71<span class="sc">~</span>qsmk, <span class="at">data=</span>nhefs[nhefs<span class="sc">$</span>ps.dec<span class="sc">==</span>i,]))</span>
<span id="cb511-4"><a href="module-6-introduction-to-causal-intference.html#cb511-4" tabindex="-1"></a>}</span></code></pre></div>
<p>Alternatively, we can include the clusters in a regression model with or without an interaction between strata and treatment. We will also include some of the covariates that were not properly balanced to make sure we are accounting for them.</p>
<div class="sourceCode" id="cb512"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb512-1"><a href="module-6-introduction-to-causal-intference.html#cb512-1" tabindex="-1"></a><span class="co"># Fit linear model for treatment effect</span></span>
<span id="cb512-2"><a href="module-6-introduction-to-causal-intference.html#cb512-2" tabindex="-1"></a>strat_mod <span class="ot">&lt;-</span> <span class="fu">lm</span>(wt82_71<span class="sc">~</span>qsmk<span class="sc">+</span>ps.dec<span class="sc">+</span>wt71<span class="sc">+</span>smokeintensity<span class="sc">+</span>smokeyrs, <span class="at">data=</span>nhefs)</span>
<span id="cb512-3"><a href="module-6-introduction-to-causal-intference.html#cb512-3" tabindex="-1"></a><span class="fu">summary</span>(strat_mod)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = wt82_71 ~ qsmk + ps.dec + wt71 + smokeintensity + 
##     smokeyrs, data = nhefs)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -42.237  -3.949  -0.188   3.960  46.159 
## 
## Coefficients:
##                Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)     9.11744    1.10622   8.242 3.56e-16 ***
## qsmk            3.31036    0.44858   7.380 2.58e-13 ***
## ps.dec2        -0.12982    0.85836  -0.151  0.87980    
## ps.dec3        -0.39237    0.86324  -0.455  0.64951    
## ps.dec4         0.44004    0.86500   0.509  0.61102    
## ps.dec5         0.08647    0.88067   0.098  0.92180    
## ps.dec6        -0.24376    0.89186  -0.273  0.78465    
## ps.dec7         0.37505    0.91970   0.408  0.68348    
## ps.dec8        -1.44770    0.93304  -1.552  0.12096    
## ps.dec9        -2.21550    0.96359  -2.299  0.02162 *  
## ps.dec10       -2.58065    0.99414  -2.596  0.00952 ** 
## wt71           -0.06733    0.01324  -5.086 4.10e-07 ***
## smokeintensity  0.02110    0.01825   1.156  0.24791    
## smokeyrs       -0.09759    0.01763  -5.536 3.63e-08 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 7.53 on 1552 degrees of freedom
##   (63 observations deleted due to missingness)
## Multiple R-squared:  0.09435,    Adjusted R-squared:  0.08676 
## F-statistic: 12.44 on 13 and 1552 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
<div id="inverse-probability-weighting" class="section level5 hasAnchor">
<h5>Inverse Probability Weighting<a href="module-6-introduction-to-causal-intference.html#inverse-probability-weighting" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>For inverse probability weighting, we need to calculate the weights given the propensity scores as</p>
<p><span class="math inline">\(w_i = \frac{A_i}{\pi_i}+\frac{(1-A_i)}{1-\pi_i},\)</span></p>
<p>where <span class="math inline">\(A_i\)</span> is the treatment level for individual i and <span class="math inline">\(\pi_i\)</span> is the propensity score for individual i.</p>
<div class="sourceCode" id="cb514"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb514-1"><a href="module-6-introduction-to-causal-intference.html#cb514-1" tabindex="-1"></a><span class="co"># with the propensity scores, let&#39;s calculate the weights</span></span>
<span id="cb514-2"><a href="module-6-introduction-to-causal-intference.html#cb514-2" tabindex="-1"></a>nhefs <span class="ot">&lt;-</span> nhefs <span class="sc">%&gt;%</span></span>
<span id="cb514-3"><a href="module-6-introduction-to-causal-intference.html#cb514-3" tabindex="-1"></a>          <span class="fu">mutate</span>(<span class="at">weights =</span> <span class="fu">case_when</span>(qsmk<span class="sc">==</span><span class="dv">1</span><span class="sc">~</span><span class="dv">1</span><span class="sc">/</span>ps_log,</span>
<span id="cb514-4"><a href="module-6-introduction-to-causal-intference.html#cb514-4" tabindex="-1"></a>                                     qsmk<span class="sc">==</span><span class="dv">0</span><span class="sc">~</span><span class="dv">1</span><span class="sc">/</span>(<span class="dv">1</span><span class="sc">-</span>ps_log)))</span>
<span id="cb514-5"><a href="module-6-introduction-to-causal-intference.html#cb514-5" tabindex="-1"></a>nhefs<span class="sc">$</span>weights</span>
<span id="cb514-6"><a href="module-6-introduction-to-causal-intference.html#cb514-6" tabindex="-1"></a></span>
<span id="cb514-7"><a href="module-6-introduction-to-causal-intference.html#cb514-7" tabindex="-1"></a><span class="co"># let&#39;s visualize the weights</span></span>
<span id="cb514-8"><a href="module-6-introduction-to-causal-intference.html#cb514-8" tabindex="-1"></a><span class="fu">hist</span>(nhefs<span class="sc">$</span>weights)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-162-1.png" width="672" /></p>
<div class="sourceCode" id="cb515"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb515-1"><a href="module-6-introduction-to-causal-intference.html#cb515-1" tabindex="-1"></a><span class="fu">boxplot</span>(nhefs<span class="sc">$</span>weights)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-162-2.png" width="672" /></p>
<div class="sourceCode" id="cb516"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb516-1"><a href="module-6-introduction-to-causal-intference.html#cb516-1" tabindex="-1"></a><span class="co"># let&#39;s look at the treatment and propensity score for largest weight and smallest weight</span></span>
<span id="cb516-2"><a href="module-6-introduction-to-causal-intference.html#cb516-2" tabindex="-1"></a>nhefs[<span class="fu">which.min</span>(nhefs<span class="sc">$</span>weights), <span class="fu">c</span>(<span class="st">&quot;ps_log&quot;</span>, <span class="st">&quot;qsmk&quot;</span>)]</span>
<span id="cb516-3"><a href="module-6-introduction-to-causal-intference.html#cb516-3" tabindex="-1"></a>nhefs[<span class="fu">which.max</span>(nhefs<span class="sc">$</span>weights), <span class="fu">c</span>(<span class="st">&quot;ps_log&quot;</span>, <span class="st">&quot;qsmk&quot;</span>)]</span></code></pre></div>
<p>Now that we have our weights, we can check the balance in the weighted sample using the weights argument in bal.tab</p>
<div class="sourceCode" id="cb517"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb517-1"><a href="module-6-introduction-to-causal-intference.html#cb517-1" tabindex="-1"></a><span class="co"># now check balance in weighted sample</span></span>
<span id="cb517-2"><a href="module-6-introduction-to-causal-intference.html#cb517-2" tabindex="-1"></a><span class="fu">bal.tab</span>(qsmk <span class="sc">~</span> sex <span class="sc">+</span> race <span class="sc">+</span> age <span class="sc">+</span> education</span>
<span id="cb517-3"><a href="module-6-introduction-to-causal-intference.html#cb517-3" tabindex="-1"></a>        <span class="sc">+</span> smokeintensity <span class="sc">+</span> smokeyrs</span>
<span id="cb517-4"><a href="module-6-introduction-to-causal-intference.html#cb517-4" tabindex="-1"></a>        <span class="sc">+</span> exercise <span class="sc">+</span> active</span>
<span id="cb517-5"><a href="module-6-introduction-to-causal-intference.html#cb517-5" tabindex="-1"></a>        <span class="sc">+</span> wt71, <span class="at">data =</span> nhefs, <span class="at">m.threshold=</span><span class="fl">0.1</span>, <span class="at">weights=</span>nhefs<span class="sc">$</span>weights)</span></code></pre></div>
<pre><code>## Note: `s.d.denom` not specified; assuming &quot;pooled&quot;.</code></pre>
<pre><code>## Balance Measures
##                   Type Diff.Adj    M.Threshold
## sex             Binary  -0.0039 Balanced, &lt;0.1
## race            Binary   0.0007 Balanced, &lt;0.1
## age            Contin.   0.0184 Balanced, &lt;0.1
## education_1     Binary  -0.0087 Balanced, &lt;0.1
## education_2     Binary   0.0031 Balanced, &lt;0.1
## education_3     Binary  -0.0051 Balanced, &lt;0.1
## education_4     Binary   0.0081 Balanced, &lt;0.1
## education_5     Binary   0.0025 Balanced, &lt;0.1
## smokeintensity Contin.  -0.0006 Balanced, &lt;0.1
## smokeyrs       Contin.   0.0151 Balanced, &lt;0.1
## exercise_0      Binary  -0.0065 Balanced, &lt;0.1
## exercise_1      Binary   0.0179 Balanced, &lt;0.1
## exercise_2      Binary  -0.0114 Balanced, &lt;0.1
## active_0        Binary  -0.0075 Balanced, &lt;0.1
## active_1        Binary   0.0140 Balanced, &lt;0.1
## active_2        Binary  -0.0065 Balanced, &lt;0.1
## wt71           Contin.   0.0014 Balanced, &lt;0.1
## 
## Balance tally for mean differences
##                    count
## Balanced, &lt;0.1        17
## Not Balanced, &gt;0.1     0
## 
## Variable with the greatest mean difference
##  Variable Diff.Adj    M.Threshold
##       age   0.0184 Balanced, &lt;0.1
## 
## Effective sample sizes
##            Control Treated
## Unadjusted  1201.   428.  
## Adjusted    1172.8  360.04</code></pre>
<p>Finally, let’s estimate the treatment effect again.</p>
<div class="sourceCode" id="cb520"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb520-1"><a href="module-6-introduction-to-causal-intference.html#cb520-1" tabindex="-1"></a><span class="co"># now we can fit our linear model to the weighted sample</span></span>
<span id="cb520-2"><a href="module-6-introduction-to-causal-intference.html#cb520-2" tabindex="-1"></a>weight_lm <span class="ot">&lt;-</span> <span class="fu">lm</span>(wt82_71<span class="sc">~</span>qsmk, <span class="at">weights=</span>weights, <span class="at">data=</span>nhefs)</span>
<span id="cb520-3"><a href="module-6-introduction-to-causal-intference.html#cb520-3" tabindex="-1"></a><span class="fu">summary</span>(weight_lm)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = wt82_71 ~ qsmk, data = nhefs, weights = weights)
## 
## Weighted Residuals:
##     Min      1Q  Median      3Q     Max 
## -51.682  -5.334   0.049   5.209  85.111 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)   1.7685     0.2863   6.177 8.33e-10 ***
## qsmk          3.4036     0.4076   8.351  &lt; 2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 11.36 on 1564 degrees of freedom
##   (63 observations deleted due to missingness)
## Multiple R-squared:  0.04268,    Adjusted R-squared:  0.04207 
## F-statistic: 69.73 on 1 and 1564 DF,  p-value: &lt; 2.2e-16</code></pre>
<div class="callout-green">
<span class="callout-icon"><i class="fas fa-circle-check" aria-hidden="true"></i></span>
<div class="callout-content">
<div class="callout-title-static" style="margin-bottom: 0.5em;">
<p>Lab Completed!</p>
</div>
<p>Congratulations! You have completed Lab 6!</p>
</div>
</div>

</div>
</div>
</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="module-5-putting-it-all-together.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
  "sharing": {
    "github": false,
    "facebook": true,
    "twitter": true,
    "linkedin": false,
    "weibo": false,
    "instapaper": false,
    "vk": false,
    "whatsapp": false,
    "all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
  },
  "fontsettings": {
    "theme": "white",
    "family": "sans",
    "size": 2
  },
  "edit": {
    "link": "https://github.com/bioinformaticsdotca/STAT_2024/blob/main/060-module-6.Rmd",
    "text": "Edit"
  },
  "history": {
    "link": null,
    "text": null
  },
  "view": {
    "link": null,
    "text": null
  },
  "download": ["_main.pdf", "_main.epub"],
  "search": {
    "engine": "fuse",
    "options": null
  },
  "toc": {
    "collapse": "subsection"
  }
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
